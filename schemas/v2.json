{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Example YAML Spec v2",
  "type": "object",

  "definitions": {
    "semver_v2": {
      "type": "string",
      "pattern": "^v2(?:\\.(?:0|[1-9]\\d*)){0,2}(?:-(?:0|[1-9]\\d*|[A-Za-z-][0-9A-Za-z-]*)(?:\\.(?:0|[1-9]\\d*|[A-Za-z-][0-9A-Za-z-]*))*)?(?:\\+[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?$"
    },
    "data_port": {
      "type": "object",
      "required": ["name", "schema"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "schema": {
          "oneOf": [
            { "type": "object" },
            { "type": "string", "minLength": 2 }
          ]
        },
        "description": { "type": "string" },
        "required": { "type": "boolean" },
        "example": {}
      },
      "additionalProperties": false
    },
    "miniprogram": {
      "type": "object",
      "required": ["name", "description", "inputs", "outputs"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string", "minLength": 1 },
        "inputs": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/definitions/data_port" }
        },
        "outputs": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/definitions/data_port" }
        },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    }
  },

  "properties": {
    "spec_version": {
      "allOf": [
        { "$ref": "#/definitions/semver_v2" }
      ],
      "description": "Version of this specification/schema; not the version of the described document. Must be v2.x."
    },

    "meta": {
      "type": "object",
      "required": ["title", "version"],
      "properties": {
        "title": { "type": "string", "minLength": 1 },
        "version": {
          "type": "string",
          "pattern": "^v(?:0|[1-9]\\d*)(?:\\.(?:0|[1-9]\\d*)){0,2}(?:-(?:0|[1-9]\\d*|[A-Za-z-][0-9A-Za-z-]*)(?:\\.(?:0|[1-9]\\d*|[A-Za-z-][0-9A-Za-z-]*))*)?(?:\\+[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?$"
        },
        "purpose": { "type": "string" },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },

    "algorithm": {
      "type": "object",
      "required": ["name", "phases"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "phases": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 1 },
          "uniqueItems": true
        }
      },
      "additionalProperties": false
    },

    "implementation": {
      "type": "object",
      "required": ["language", "entrypoint", "return_contract", "source"],
      "properties": {
        "language": { "type": "string", "minLength": 1 },
        "entrypoint": { "type": "string", "minLength": 1 },
        "parameters": {
          "type": "object",
          "additionalProperties": {
            "oneOf": [
              { "type": "string", "minLength": 1 },
              {
                "type": "object",
                "properties": {
                  "type": { "type": "string" },
                  "required": { "type": "boolean" },
                  "default": {},
                  "description": { "type": "string" },
                  "enum": { "type": "array" },
                  "schema": { "type": "object" }
                },
                "additionalProperties": false
              }
            ]
          }
        },
        "return_contract": {
          "type": "object",
          "required": ["schema"],
          "properties": {
            "schema": {
              "oneOf": [
                { "type": "object" },
                { "type": "string", "minLength": 2 }
              ]
            }
          },
          "additionalProperties": false
        },
        "source": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/definitions/miniprogram" }
        },
        "formats": {}
      },
      "additionalProperties": false
    }
  },

  "patternProperties": {
    "^x-": {}
  },

  "required": ["spec_version", "meta", "algorithm", "implementation"],
  "additionalProperties": false
}
